{"version":3,"file":"store.js","sources":["../../../modules/store/src/module.ts","../../../modules/store/src/select.ts"],"sourcesContent":["import { NgModule } from '@angular/core';\nimport { NgrxSelect } from './select';\n\n@NgModule({\n  providers: [NgrxSelect]\n})\nexport class NgrxUtilsModule {}\n","import { Injectable } from '@angular/core';\nimport { Store, Selector, createFeatureSelector, createSelector } from '@ngrx/store';\n\n@Injectable()\nexport class NgrxSelect {\n\n  /**\n   * @internal\n   */\n  static store: Store<any> | undefined = undefined;\n\n  /**\n   * @internal\n   */\n  static selectorMap: { [key: string]: Selector<any, any> } = {};\n\n  connect(store: Store<any>) {\n    NgrxSelect.store = store;\n  }\n}\n\nexport function Select<TState = any, TValue = any>(\n  selector: Selector<TState, TValue>\n): (target: any, name: string) => void;\nexport function Select(selectorOrFeature?: string, ...paths: string[]): (target: any, name: string) => void;\nexport function Select(selectorOrFeature?: string | Selector<any, any>, ...paths: string[]) {\n  return function(target: any, name: string): void {\n    let fn: Selector<any, any>;\n    // Nothing here? Use property name as selector\n    if (!selectorOrFeature) {\n      selectorOrFeature = name;\n    }\n    // Handle string vs Selector<any, any>\n    if (typeof selectorOrFeature === 'string') {\n      const propsArray = paths.length ? [selectorOrFeature, ...paths] : selectorOrFeature.split('.');\n      fn = getSelector(propsArray);\n    } else {\n      fn = selectorOrFeature;\n    }\n    // Redefine property\n    if (delete target[name]) {\n      Object.defineProperty(target, name, {\n        get: () => {\n          // get connected store\n          const store = NgrxSelect.store;\n          if (!store) {\n            throw new Error('NgrxSelect not connected to store!');\n          }\n          return store.select(fn);\n        },\n        enumerable: true,\n        configurable: true\n      });\n    }\n  };\n}\n\nfunction getSelector(paths: string[]): Selector<any, any> {\n  const selectorMap = NgrxSelect.selectorMap;\n  const key = paths.join('.');\n  const cachedSelector = selectorMap[key];\n\n  if (cachedSelector) return cachedSelector;\n\n  const [featureName, ...propNames] = paths;\n  const getFeature = createFeatureSelector(featureName);\n  return (selectorMap[key] = propNames.reduce(\n    (selected, prop) => createSelector(selected, (state: { [prop: string]: any }) => state[prop]),\n    getFeature\n  ));\n}\n"],"names":["store"],"mappings":";;;;;;;ACAA,AAIA,MAAA,UAAA,CAAA;;;;;IAYE,OAAO,CAACA,QAAiB,EAA3B;QACI,UAAU,CAAC,KAAK,GAAGA,QAAK,CAAC;KAC1B;;;;;AATH,UAAA,CAAA,KAAA,GAAyC,SAAS,CAAlD;;;;AAKA,UAAA,CAAA,WAAA,GAA8D,EAAE,CAAhE;;IAXA,EAAA,IAAA,EAAC,UAAU,EAAX;;;;;;;;;AAsBA,AAAA,SAAA,MAAA,CAAuB,iBAA+C,EAAE,GAAG,KAAe,EAA1F;IACE,OAAO,UAAS,MAAW,EAAE,IAAY,EAA3C;QACI,qBAAI,EAAsB,CAAC;;QAE3B,IAAI,CAAC,iBAAiB,EAAE;YACtB,iBAAiB,GAAG,IAAI,CAAC;SAC1B;;QAED,IAAI,OAAO,iBAAiB,KAAK,QAAQ,EAAE;YACzC,uBAAM,UAAU,GAAG,KAAK,CAAC,MAAM,GAAG,CAAC,iBAAiB,EAAE,GAAG,KAAK,CAAC,GAAG,iBAAiB,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;YAC/F,EAAE,GAAG,WAAW,CAAC,UAAU,CAAC,CAAC;SAC9B;aAAM;YACL,EAAE,GAAG,iBAAiB,CAAC;SACxB;;QAED,IAAI,OAAO,MAAM,CAAC,IAAI,CAAC,EAAE;YACvB,MAAM,CAAC,cAAc,CAAC,MAAM,EAAE,IAAI,EAAE;gBAClC,GAAG,EAAE,MAAb;;oBAEU,uBAAMA,QAAK,GAAG,UAAU,CAAC,KAAK,CAAC;oBAC/B,IAAI,CAACA,QAAK,EAAE;wBACV,MAAM,IAAI,KAAK,CAAC,oCAAoC,CAAC,CAAC;qBACvD;oBACD,OAAOA,QAAK,CAAC,MAAM,CAAC,EAAE,CAAC,CAAC;iBACzB;gBACD,UAAU,EAAE,IAAI;gBAChB,YAAY,EAAE,IAAI;aACnB,CAAC,CAAC;SACJ;KACF,CAAC;CACH;;;;;AAED,SAAA,WAAA,CAAqB,KAAe,EAApC;IACE,uBAAM,WAAW,GAAG,UAAU,CAAC,WAAW,CAAC;IAC3C,uBAAM,GAAG,GAAG,KAAK,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;IAC5B,uBAAM,cAAc,GAAG,WAAW,CAAC,GAAG,CAAC,CAAC;IAExC,IAAI,cAAc;QAAE,OAAO,cAAc,CAAC;IAE1C,MAAM,CAAC,WAAW,EAAE,GAAG,SAAS,CAAC,GAAG,KAAK,CAAC;IAC1C,uBAAM,UAAU,GAAG,qBAAqB,CAAC,WAAW,CAAC,CAAC;IACtD,QAAQ,WAAW,CAAC,GAAG,CAAC,GAAG,SAAS,CAAC,MAAM,CACzC,CAAC,QAAQ,EAAE,IAAI,KAAK,cAAc,CAAC,QAAQ,EAAE,CAAC,KAA8B,KAAK,KAAK,CAAC,IAAI,CAAC,CAAC,EAC7F,UAAU,CACX,EAAE;CACJ;;;;;;ADtED,AAMA,MAAA,eAAA,CAAA;;;IAHA,EAAA,IAAA,EAAC,QAAQ,EAAT,IAAA,EAAA,CAAU;gBACR,SAAS,EAAE,CAAC,UAAU,CAAC;aACxB,EAAD,EAAA;;;;;;;;;;;;;;;;;;;;;;;;;"}