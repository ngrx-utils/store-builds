{"version":3,"file":"store.es5.js","sources":["../../../modules/store/src/module.ts","../../../modules/store/src/select.ts"],"sourcesContent":["import { NgModule } from '@angular/core';\nimport { NgrxSelect } from './select';\n\n@NgModule({\n  providers: [NgrxSelect]\n})\nexport class NgrxUtilsModule {}\n","import { Injectable } from '@angular/core';\nimport { Store, Selector, createFeatureSelector, createSelector } from '@ngrx/store';\n\n@Injectable()\nexport class NgrxSelect {\n  static store: Store<any> | undefined = undefined;\n  static selectorMap: { [key: string]: Selector<any, any> } = {};\n\n  connect(store: Store<any>) {\n    NgrxSelect.store = store;\n  }\n}\n\nexport function Select<TState = any, TValue = any>(\n  selector: Selector<TState, TValue>\n): (target: any, name: string) => void;\nexport function Select(selectorOrFeature?: string, ...paths: string[]): (target: any, name: string) => void;\nexport function Select(selectorOrFeature?: string | Selector<any, any>, ...paths: string[]) {\n  return function(target: any, name: string): void {\n    let fn: Selector<any, any>;\n    // Nothing here? Use propery name as selector\n    if (!selectorOrFeature) {\n      selectorOrFeature = name;\n    }\n    // Handle string vs Selector<any, any>\n    if (typeof selectorOrFeature === 'string') {\n      const propsArray = paths.length ? [selectorOrFeature, ...paths] : selectorOrFeature.split('.');\n      fn = getSelector(propsArray);\n    } else {\n      fn = selectorOrFeature;\n    }\n    // Redefine property\n    if (delete target[name]) {\n      Object.defineProperty(target, name, {\n        get: () => {\n          // get connected store\n          const store = NgrxSelect.store;\n          if (!store) {\n            throw new Error('NgrxSelect not connected to store!');\n          }\n          return store.select(fn);\n        },\n        enumerable: true,\n        configurable: true\n      });\n    }\n  };\n}\n\nfunction getSelector(paths: string[]): Selector<any, any> {\n  const selectorMap = NgrxSelect.selectorMap;\n  const key = paths.join('.');\n  const cachedSelector = selectorMap[key];\n\n  if (cachedSelector) return cachedSelector;\n\n  const [featureName, ...propNames] = paths;\n  const getFeature = createFeatureSelector(featureName);\n  return (selectorMap[key] = propNames.reduce(\n    (selected, prop) => createSelector(selected, (state: { [prop: string]: any }) => state[prop]),\n    getFeature\n  ));\n}\n"],"names":["store"],"mappings":";;;;;;ACAA;IAAA;;;;;;IAQE,4BAAO,GAAP,UAAQA,QAAiB;QACvB,UAAU,CAAC,KAAK,GAAGA,QAAK,CAAC;IAC7B,CAAG;;CAVH;AAKA,UAAA,CAAA,KAAA,GAAyC,SAAS,CAAlD;AACA,UAAA,CAAA,WAAA,GAA8D,EAAE,CAAhE;;IAHA,EAAA,IAAA,EAAC,UAAU,EAAX;;;;;;;;;AAcA,gBAAuB,iBAA+C;IAAE,eAAkB;SAAlB,UAAkB,EAAlB,qBAAkB,EAAlB,IAAkB;QAAlB,8BAAkB;;IACxF,MAAF,CAAS,UAAS,MAAW,EAAE,IAAY;QACvC,IAAJ,gBAAA,CAAQ,EAAsB,CAAC;;QAE3B,EAAJ,CAAA,CAAQ,CAAC,iBAAiB,CAA1B,CAA4B,CAA5B;YACM,iBAAiB,GAAG,IAAI,CAAC;QAC/B,CAAK;;QAED,EAAJ,CAAA,CAAQ,OAAO,iBAAiB,KAAK,QAAQ,CAA7C,CAA+C,CAA/C;YACM,IAAN,gBAAA,CAAY,UAAU,GAAG,KAAK,CAAC,MAAM,CAArC,CAAA,EAAyC,iBAAiB,SAAK,KAAK,EAApE,CAAA,CAAwE,iBAAiB,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;YAC/F,EAAE,GAAG,WAAW,CAAC,UAAU,CAAC,CAAC;QACnC,CAAK;QAAL,IAAA,CAAW,CAAX;YACM,EAAE,GAAG,iBAAiB,CAAC;QAC7B,CAAK;;QAED,EAAJ,CAAA,CAAQ,OAAO,MAAM,CAAC,IAAI,CAAC,CAA3B,CAA6B,CAA7B;YACM,MAAM,CAAC,cAAc,CAAC,MAAM,EAAE,IAAI,EAAE;gBAClC,GAAG,EAAE;;oBAEH,IAAV,gBAAA,CAAgBA,QAAK,GAAG,UAAU,CAAC,KAAK,CAAC;oBAC/B,EAAV,CAAA,CAAc,CAACA,QAAK,CAApB,CAAsB,CAAtB;wBACY,MAAM,IAAI,KAAK,CAAC,oCAAoC,CAAC,CAAC;oBAClE,CAAW;oBACD,MAAV,CAAiBA,QAAK,CAAC,MAAM,CAAC,EAAE,CAAC,CAAC;gBAClC,CAAS;gBACD,UAAU,EAAE,IAAI;gBAChB,YAAY,EAAE,IAAI;aACnB,CAAC,CAAC;QACT,CAAK;IACL,CAAG,CAAC;AACJ,CAAC;;;;;AAED,qBAAqB,KAAe;IAClC,IAAF,gBAAA,CAAQ,WAAW,GAAG,UAAU,CAAC,WAAW,CAAC;IAC3C,IAAF,gBAAA,CAAQ,GAAG,GAAG,KAAK,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;IAC5B,IAAF,gBAAA,CAAQ,cAAc,GAAG,WAAW,CAAC,GAAG,CAAC,CAAC;IAExC,EAAF,CAAA,CAAM,cAAc,CAApB;QAAsB,MAAtB,CAA6B,cAAc,CAAC;IAEnC,IAAA,sBAAW,EAAE,0BAAY,CAAU;IAC1C,IAAF,gBAAA,CAAQ,UAAU,GAAG,qBAAqB,CAAC,WAAW,CAAC,CAAC;IACtD,MAAF,CAAA,CAAU,WAAW,CAAC,GAAG,CAAC,GAAG,SAAS,CAAC,MAAM,CACzC,UAAC,QAAQ,EAAE,IAAI,IAAK,OAAA,cAAc,CAAC,QAAQ,EAAE,UAAC,KAA8B,IAAK,OAAA,KAAK,CAAC,IAAI,CAAC,EAAX,CAAW,CAAC,EAAzE,CAAyE,EAC7F,UAAU,CACX,CAHH,CAGK;AACL,CAAC;;;;;AD9DD;IAAA;;;CAAA;;IAGA,EAAA,IAAA,EAAC,QAAQ,EAAT,IAAA,EAAA,CAAU;gBACR,SAAS,EAAE,CAAC,UAAU,CAAC;aACxB,EAAD,EAAA;;;;;;;;;;;;;;;;;;;;"}