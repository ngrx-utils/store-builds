{"version":3,"file":"store.umd.js","sources":["../../../modules/store/src/module.ts","../../../modules/store/src/select.ts"],"sourcesContent":["import { NgModule } from '@angular/core';\nimport { NgrxSelect } from './select';\n\n@NgModule({\n  providers: [NgrxSelect]\n})\nexport class NgrxUtilsModule {}\n","import { Injectable } from '@angular/core';\nimport { Store, Selector, createFeatureSelector, createSelector } from '@ngrx/store';\n\n@Injectable()\nexport class NgrxSelect {\n  static store: Store<any> | undefined = undefined;\n  static selectorMap: { [key: string]: Selector<any, any> } = {};\n\n  connect(store: Store<any>) {\n    NgrxSelect.store = store;\n  }\n}\n\nexport function Select<TState = any, TValue = any>(\n  selector: Selector<TState, TValue>\n): (target: any, name: string) => void;\nexport function Select(selectorOrFeature?: string, ...paths: string[]): (target: any, name: string) => void;\nexport function Select(selectorOrFeature?: string | Selector<any, any>, ...paths: string[]) {\n  return function(target: any, name: string): void {\n    let fn: Selector<any, any>;\n    // Nothing here? Use propery name as selector\n    if (!selectorOrFeature) {\n      selectorOrFeature = name;\n    }\n    // Handle string vs Selector<any, any>\n    if (typeof selectorOrFeature === 'string') {\n      const propsArray = paths.length ? [selectorOrFeature, ...paths] : selectorOrFeature.split('.');\n      fn = getSelector(propsArray);\n    } else {\n      fn = selectorOrFeature;\n    }\n    // Redefine property\n    if (delete target[name]) {\n      Object.defineProperty(target, name, {\n        get: () => {\n          // get connected store\n          const store = NgrxSelect.store;\n          if (!store) {\n            throw new Error('NgrxSelect not connected to store!');\n          }\n          return store.select(fn);\n        },\n        enumerable: true,\n        configurable: true\n      });\n    }\n  };\n}\n\nfunction getSelector(paths: string[]): Selector<any, any> {\n  const selectorMap = NgrxSelect.selectorMap;\n  const key = paths.join('.');\n  const cachedSelector = selectorMap[key];\n\n  if (cachedSelector) return cachedSelector;\n\n  const [featureName, ...propNames] = paths;\n  const getFeature = createFeatureSelector(featureName);\n  return (selectorMap[key] = propNames.reduce(\n    (selected, prop) => createSelector(selected, (state: { [prop: string]: any }) => state[prop]),\n    getFeature\n  ));\n}\n"],"names":["NgModule","createSelector","createFeatureSelector","store","Injectable"],"mappings":";;;;;;;;;;ACAA,IAAA,UAAA,kBAAA,YAAA;IAAA,SAAA,UAAA,GAAA;;;;;;IAQE,UAAF,CAAA,SAAA,CAAA,OAAS,GAAP,UAAQG,QAAiB,EAA3B;QACI,UAAU,CAAC,KAAK,GAAGA,QAAK,CAAC;KAC1B,CAAH;;CAVA,EAAA,CAAA,CAAA;AAKA,UAAA,CAAA,KAAA,GAAyC,SAAS,CAAlD;AACA,UAAA,CAAA,WAAA,GAA8D,EAAE,CAAhE;;IAHA,EAAA,IAAA,EAACC,eAAU,EAAX;;;;;;;;;AAcA,SAAA,MAAA,CAAuB,iBAA+C,EAAtE;IAAwE,IAAxE,KAAA,GAAA,EAAA,CAA0F;IAA1F,KAAwE,IAAxE,EAAA,GAAA,CAA0F,EAAlB,EAAxE,GAAA,SAAA,CAAA,MAA0F,EAAlB,EAAxE,EAA0F,EAA1F;QAAwE,KAAxE,CAAA,EAAA,GAAA,CAAA,CAAA,GAAA,SAAA,CAAA,EAAA,CAAA,CAA0F;;IACxF,OAAO,UAAS,MAAW,EAAE,IAAY,EAA3C;QACI,qBAAI,EAAsB,CAAC;;QAE3B,IAAI,CAAC,iBAAiB,EAAE;YACtB,iBAAiB,GAAG,IAAI,CAAC;SAC1B;;QAED,IAAI,OAAO,iBAAiB,KAAK,QAAQ,EAAE;YACzC,qBAAM,UAAU,GAAG,KAAK,CAAC,MAAM,GAArC,CAAyC,iBAAiB,CAA1D,CAAA,MAAA,CAA+D,KAAK,CAApE,GAAwE,iBAAiB,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;YAC/F,EAAE,GAAG,WAAW,CAAC,UAAU,CAAC,CAAC;SAC9B;aAAM;YACL,EAAE,GAAG,iBAAiB,CAAC;SACxB;;QAED,IAAI,OAAO,MAAM,CAAC,IAAI,CAAC,EAAE;YACvB,MAAM,CAAC,cAAc,CAAC,MAAM,EAAE,IAAI,EAAE;gBAClC,GAAG,EAAE,YAAb;;oBAEU,qBAAMD,QAAK,GAAG,UAAU,CAAC,KAAK,CAAC;oBAC/B,IAAI,CAACA,QAAK,EAAE;wBACV,MAAM,IAAI,KAAK,CAAC,oCAAoC,CAAC,CAAC;qBACvD;oBACD,OAAOA,QAAK,CAAC,MAAM,CAAC,EAAE,CAAC,CAAC;iBACzB;gBACD,UAAU,EAAE,IAAI;gBAChB,YAAY,EAAE,IAAI;aACnB,CAAC,CAAC;SACJ;KACF,CAAC;CACH;;;;;AAED,SAAA,WAAA,CAAqB,KAAe,EAApC;IACE,qBAAM,WAAW,GAAG,UAAU,CAAC,WAAW,CAAC;IAC3C,qBAAM,GAAG,GAAG,KAAK,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;IAC5B,qBAAM,cAAc,GAAG,WAAW,CAAC,GAAG,CAAC,CAAC;IAExC,IAAI,cAAc;QAAE,OAAO,cAAc,CAAC;IAEnC,IAAA,WAAT,GAAA,KAAA,CAAA,CAAA,CAAoB,EAAE,SAAtB,GAAA,KAAA,CAAA,KAAA,CAAA,CAAA,CAAkC,CAAU;IAC1C,qBAAM,UAAU,GAAGD,2BAAqB,CAAC,WAAW,CAAC,CAAC;IACtD,QAAQ,WAAW,CAAC,GAAG,CAAC,GAAG,SAAS,CAAC,MAAM,CACzC,UAAC,QAAQ,EAAE,IAAI,EADnB,EACwB,OAAAD,oBAAc,CAAC,QAAQ,EAAE,UAAC,KAA8B,EADhF,EACqF,OAAA,KAAK,CAAC,IAAI,CAAC,CADhG,EACgG,CAAC,CADjG,EACiG,EAC7F,UAAU,CACX,EAAE;CACJ;;;;;AD9DD,IAAA,eAAA,kBAAA,YAAA;IAAA,SAAA,eAAA,GAAA;;;CAAA,EAAA,CAAA,CAAA;;IAGA,EAAA,IAAA,EAACD,aAAQ,EAAT,IAAA,EAAA,CAAU;gBACR,SAAS,EAAE,CAAC,UAAU,CAAC;aACxB,EAAD,EAAA;;;;;;;;;;;;;;;;;"}